!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports):"function"==typeof define&&define.amd?define(["exports"],b):b(a.src={})}(this,function(a){"use strict";function b(){return"http://localhost:8888/"}function c(){return"myplugin"}function d(){return b()+"src/build/plugins/"+c()+"/styles/"+c()+".css"}function f(){return ESPA.plugins.getRequest("local",{url:"src/build/myapp/mock/dummy.json",cache:!0})}function g(a){return new Promise(function(b,c){b(a)})}function h(a){F=a,E.augmentViewData(D,F);var b=(F.wizardState,F.currentPageState);void 0===b.radioId&&(b.radioId="rad1");var c=ESPA.plugins.state.get();return Promise.all([ESPA.loadResource.css(d()),f()]).then(function(a){G=a[1],F=Object.assign(F,G),c.identity.forEach(function(a){"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier"==a.name&&(F.user=a.value),console.log(a)}),F.entitlements=c.entitlements,ESPA.plugins.wizardEngine.setCurrentState({backPage:E.getBackPage(F),currentPage:E,nextPage:"page-two",back:!0,next:!0,cancel:!0,finish:!1}),i()}).catch(function(a){return ESPA.logger.error(a),Promise.reject({error:"_registerRouteCallback promise chain terminated"})})}function i(){var a=F.currentPageState;document.getElementById("loader").style.display="none",document.getElementById("wizard-content").innerHTML=ESPA.tmpl(H.factoryScope.tpl,F),document.getElementById("main-container").style.display="block",ESPA.plugins.bindEvents({"click #submitActivationKey":k,"click #rad1":j,"click #rad2":j}),document.getElementById(a.radioId).checked=!0}function j(a){F.currentPageState.radioId=a.srcElement.id;var b=a.srcElement.value;ESPA.plugins.wizardEngine.getCurrentState().nextPage=b}function k(a){a.preventDefault(),new SimpleDate(2e3,2,28).addDays(1);var b=ESPA.plugins.state.get(),c=document.getElementById("activationKey");b.activationKey=c.value,c=document.getElementById("activationKeyEcho"),c.value=b.activationKey}function l(a){M=a,L.augmentViewData(K,M);M.wizardState,M.currentPageState,ESPA.plugins.state.get();return Promise.all([ESPA.loadResource.css(d()),f()]).then(function(a){N=a[1],M=Object.assign(M,N),ESPA.plugins.wizardEngine.setCurrentState({backPage:L.getBackPage(M),currentPage:L,nextPage:null,back:!0,next:!1,finish:!0,cancel:!0}),m()}).catch(function(a){return ESPA.logger.error(a),Promise.reject({error:"_registerRouteCallback promise chain terminated"})})}function m(){document.getElementById("loader").style.display="none",document.getElementById("wizard-content").innerHTML=ESPA.tmpl(O.factoryScope.tpl,M),document.getElementById("main-container").style.display="block",ESPA.plugins.bindEvents({"click #submitActivationKey":n})}function n(a){a.preventDefault();var b=ESPA.plugins.state.get(),c=document.getElementById("activationKey");b.activationKey=c.value,c=document.getElementById("activationKeyEcho"),c.value=b.activationKey}function o(a){T=a,S.augmentViewData(R,T);T.wizardState,T.currentPageState,ESPA.plugins.state.get();return Promise.all([ESPA.loadResource.css(d()),f()]).then(function(a){U=a[1],T=Object.assign(T,U),ESPA.plugins.wizardEngine.setCurrentState({backPage:S.getBackPage(T),currentPage:S,nextPage:null,back:!0,next:!1,finish:!0,cancel:!0}),p()}).catch(function(a){return ESPA.logger.error(a),Promise.reject({error:"_registerRouteCallback promise chain terminated"})})}function p(){document.getElementById("loader").style.display="none",document.getElementById("wizard-content").innerHTML=ESPA.tmpl(V.factoryScope.tpl,T),document.getElementById("main-container").style.display="block",ESPA.plugins.bindEvents({})}function q(){var a={grant_type:"arbitrary_identity",client_id:"arbitrary-resource-owner-client",client_secret:"secret",scope:"wizard",arbitrary_claims:"{'preferred_username': ['porky@pig.com'],'name': ['porky@pig.com']}",subject:"PorkyPig",arbitrary_amrs:"['agent:username:agent0@supporttech.com','agent:challenge:fullSSN','agent:challenge:homeZip']",arbitrary_audiences:"['cat','dog']",custom_payload:"{'b':['cat','dog'],'a': {'0': {'Street1': '0 Montana Ave','Street2': null,'Street3': null,'Zip': '90403','City': 'Santa Monica','State': 'California','Country': 'USA'},'1': {'Street1': '1 Montana Ave','Street2': null,'Street3': null,'Zip': '90403','City': 'Santa Monica','State': 'California','Country': 'USA'}}}"},b=[];for(var c in a){var d=encodeURIComponent(c),e=encodeURIComponent(a[c]);b.push(d+"="+e)}return b=b.join("&"),ESPA.plugins.fetchService.fetch("https://p7identityserver4.azurewebsites.net/connect/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},body:b})}function r(a){var b={id_token:a},c=[];for(var d in b){var e=encodeURIComponent(d),f=encodeURIComponent(b[d]);c.push(e+"="+f)}return c=c.join("&"),ESPA.plugins.fetchService.fetch("https://wizardappapi.azurewebsites.net/api/Identity/bind",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},body:c})}function s(a){return ESPA.plugins.fetchService.fetch("https://wizardappapi.azurewebsites.net/api/Identity/closed",{headers:{Authorization:"Bearer "+a,"x-authScheme":"One"}})}function t(a){var b="https://wizardappapi.azurewebsites.net/api/RemoteJsonFile/open?file="+a;return ESPA.plugins.fetchService.fetch(b)}function u(a){return ESPA.plugins.fetchService.fetch("https://wizardappapi.azurewebsites.net/api/RemoteJsonFile/closed?file=entitlements.json",{headers:{Authorization:"Bearer "+a,"x-authScheme":"One"}})}function v(a){$=a,Z.augmentViewData(Y,$);var b=$.wizardState;$.currentPageState.access_token=b.access_token;ESPA.plugins.state.get();return Promise.all([ESPA.loadResource.css(d())]).then(function(a){$=Object.assign($,_),ESPA.plugins.wizardEngine.setCurrentState({backPage:Z.getBackPage($),currentPage:Z,nextPage:"page-one",back:!0,next:!0,cancel:!0,finish:!1}),w()}).catch(function(a){return ESPA.logger.error(a),Promise.reject({error:"_registerRouteCallback promise chain terminated"})})}function w(){document.getElementById("loader").style.display="none",document.getElementById("wizard-content").innerHTML=ESPA.tmpl(aa.factoryScope.tpl,$),document.getElementById("main-container").style.display="block",ESPA.plugins.bindEvents({});var a=ESPA.plugins.state.get();if(a.access_token){document.getElementById("access_token").value=a.access_token}}function x(a){fa=a,ea.augmentViewData(da,fa);ESPA.plugins.state.get();return Promise.all([ESPA.loadResource.css(d()),q()]).then(function(a){var b=a[1];if(fa=Object.assign(fa,ga),200!=b.response.status){document.getElementById("id_token_error").innerHTML="id_token has not been created!"}else{var c=b.json;fa.currentPageState.id_token=c.id_token}var d=ea.getBackPage(fa);ESPA.plugins.wizardEngine.setCurrentState({backPage:d,currentPage:ea,nextPage:"page-access-token",back:!!d,next:!0,cancel:!0,finish:!1}),y()}).catch(function(a){return ESPA.logger.error(a),Promise.reject({error:"_registerRouteCallback promise chain terminated"})})}function y(){if(document.getElementById("loader").style.display="none",document.getElementById("wizard-content").innerHTML=ESPA.tmpl(ha.factoryScope.tpl,fa),document.getElementById("main-container").style.display="block",fa.currentPageState.id_token){document.getElementById("id_token").value=fa.currentPageState.id_token}}function z(a){ma=a,la.augmentViewData(ka,ma);var b=(ma.wizardState,ma.currentPageState);void 0===b.radioId&&(b.radioId=qa[0].id,b.harvestUrl=qa[0].value);ESPA.plugins.state.get();return Promise.all([ESPA.loadResource.css(d()),f()]).then(function(a){na=a[1],ma=Object.assign(ma,na),ma.harvestRecords=qa;var b=la.getBackPage(ma);ESPA.plugins.wizardEngine.setCurrentState({backPage:b,currentPage:la,nextPage:"page-id-token",back:!!b,next:!0,cancel:!0,finish:!1}),A()}).catch(function(a){return ESPA.logger.error(a),Promise.reject({error:"_registerRouteCallback promise chain terminated"})})}function A(){var a=ma.currentPageState;document.getElementById("loader").style.display="none",document.getElementById("wizard-content").innerHTML=ESPA.tmpl(oa.factoryScope.tpl,ma),document.getElementById("main-container").style.display="block";var b={};qa.forEach(function(a){b["click #"+a.id]=B,console.log(a)}),ESPA.plugins.bindEvents(b),document.getElementById(a.radioId).checked=!0}function B(a){var b=ma.currentPageState;b.radioId=a.srcElement.id,b.harvestUrl=a.srcElement.value}var C='<div class="container">\r\n    <h1 class="display-3">\r\n        <%= user %>\r\n    </h1>\r\n    <p>\r\n        <form>\r\n            <input id="rad1" type="radio" name="page" value="page-two"> Page Two<br>\r\n            <input id="rad2" type="radio" name="page" value="page-three"> Page Three<br>\r\n        </form>\r\n        <input id="activationKey" placeholder="enter your activation key...">\r\n        <input id="submitActivationKey" type="button" value="Submit Activation Key">\r\n    </p>\r\n\r\n    </p>\r\n    <p id="activationKeyEcho"></p>\r\n    <ul id="my-list">\r\n        <% for ( var i = 0; i < entitlements.length; i++ ) { \r\n                var entitlement = entitlements[i];%>\r\n        <li>\r\n            <%= entitlement.name %>\r\n        </li>\r\n\r\n        <% } %>\r\n\r\n\r\n    </ul>\r\n\r\n\r\n\r\n</div>',D="page-one",E=ESPA.plugins.factoryWizardPage({getRouteName:function(){return D},onNext:function(){return console.log("onNext"),g(!0)},onBack:function(){return console.log("onBack"),g(!0)},onCancel:function(){return console.log("onCancel"),g(!0)}}),F=null,G=null,H={factoryScope:null,tpl:C,wizardPage:E,registerRouteCallback:h},I=E.makeFactory(H),J='<div class="container">\r\n    <h1 class="display-3">Page Two</h1>\r\n    <p>\r\n        <input id="activationKey" placeholder="enter your activation key...">\r\n        <input id="submitActivationKey" type="button" value="Submit Activation Key"></p>\r\n\r\n    </p>\r\n    <p id="activationKeyEcho"></p>\r\n\r\n</div>',K="page-two",L=ESPA.plugins.factoryWizardPage({getRouteName:function(){return K},onNext:function(){return console.log("onNext"),g(!0)},onBack:function(){return console.log("onBack"),g(!0)},onCancel:function(){return console.log("onCancel"),g(!0)}}),M=null,N=null,O={factoryScope:null,tpl:J,wizardPage:L,registerRouteCallback:l},P=L.makeFactory(O),Q='<div class="container">\r\n    <h1 class="display-3">Page Three</h1>\r\n\r\n</div>',R="page-three",S=ESPA.plugins.factoryWizardPage({getRouteName:function(){return R},onNext:function(){return console.log("onNext"),g(!0)},onBack:function(){return console.log("onBack"),g(!0)},onCancel:function(){return console.log("onCancel"),g(!0)}}),T=null,U=null,V={factoryScope:null,tpl:Q,wizardPage:S,registerRouteCallback:o},W=S.makeFactory(V),X='<div class="container">\r\n    <h1 class="display-3">access_token</h1>\r\n    <p>\r\n\r\n        <input id="access_token" placeholder="enter your access_token..." value="<%= currentPageState.access_token%>">\r\n    </p>\r\n    <p id="access_token_error"></p>\r\n\r\n</div>',Y="page-access-token",Z=ESPA.plugins.factoryWizardPage({getRouteName:function(){return Y},onNext:function(){console.log("onNext");var a=document.getElementById("access_token"),b=ESPA.plugins.state.get();return b.access_token=a.value,Promise.all([s(b.access_token).then(function(a){return a}).catch(function(a){throw ESPA.logger.error(e),new Error("apiPost error")}),u(b.access_token).then(function(a){return a}).catch(function(a){throw ESPA.logger.error(e),new Error("apiPost error")})]).then(function(a){var c=!1,d=a[0],e=a[1];if(200!=d.response.status){var f=document.getElementById("access_token_error");f.innerHTML="access_token has been rejected!"}else b.identity=d.json,c=!0;if(200!=e.response.status){var f=document.getElementById("access_token_error");f.innerHTML="entitlementResult!"}else b.entitlements=e.json.entitlements;return c}).catch(function(a){return ESPA.logger.error(a),Promise.reject({error:"_registerRouteCallback promise chain terminated"})})},onBack:function(){return console.log("onBack"),g(!0)},onCancel:function(){return console.log("onCancel"),g(!0)}}),$=null,_=null,aa={factoryScope:null,tpl:X,wizardPage:Z,registerRouteCallback:v},ba=Z.makeFactory(aa),ca='<div class="container">\r\n    <h1 class="display-3">id_token</h1>\r\n    <p>\r\n\r\n        <input id="id_token" placeholder="enter your id_token..." value="<%= currentPageState.id_token%>">\r\n    </p>\r\n    <p id="id_token_error"></p>\r\n\r\n</div>',da="page-id-token",ea=ESPA.plugins.factoryWizardPage({getRouteName:function(){return da},onNext:function(){console.log("onNext");var a=document.getElementById("id_token"),b=ESPA.plugins.state.get().wizardState,c=a.value;return new Promise(function(a,d){r(c).then(function(c){if(200!=c.response.status){document.getElementById("id_token_error").innerHTML="id_token has been rejected!",a(!1)}else{var d=c.json;b.access_token=d.access_token,a(!0)}}).catch(function(a){d(!1),console.log("There has been a problem with your fetch operation: ",a.message)})})},onBack:function(){return console.log("onBack"),g(!0)},onCancel:function(){return console.log("onCancel"),g(!0)}}),fa=null,ga=null,ha={factoryScope:null,tpl:ca,wizardPage:ea,registerRouteCallback:x},ia=ea.makeFactory(ha),ja='<div class="container">\r\n    <h1 class="display-3">\r\n        Harvestor\r\n    </h1>\r\n    <p>\r\n        <form id="my-harvest-form">\r\n            <% for ( var i = 0; i < harvestRecords.length; i++ ) { \r\n                var harvestRecord = harvestRecords[i];%>\r\n            <input id="<%= harvestRecord.id %>" \r\n            type="radio" \r\n            name="page" \r\n            value="<%= harvestRecord.value %>">\r\n            <%= harvestRecord.label %><br>\r\n \r\n            <% } %>\r\n\r\n\r\n        </form>\r\n\r\n\r\n    </p>\r\n\r\n    </p>\r\n    <p id="error"></p>\r\n\r\n\r\n\r\n</div>',ka="page-harvest",la=ESPA.plugins.factoryWizardPage({getRouteName:function(){return ka},onNext:function(){console.log("onNext");var a=ma.currentPageState,b=ESPA.plugins.state.get().wizardState;return new Promise(function(c,d){t(a.harvestUrl).then(function(a){if(200!=a.response.status){document.getElementById("error").innerHTML="harvest has been rejected!",c(!1)}else{var d=a.json;b.product_harvest=d,c(!0)}}).catch(function(a){d(!1),console.log("There has been a problem with your fetch operation: ",a.message)})})},onBack:function(){return console.log("onBack"),g(!0)},onCancel:function(){return console.log("onCancel"),g(!0)}}),ma=null,na=null,oa={factoryScope:null,tpl:ja,wizardPage:la,registerRouteCallback:z},pa=la.makeFactory(oa),qa=[{id:"rad1",value:"harvest/product-instance-one.json",label:"Product One"},{id:"rad2",value:"harvest/product-instance-two.json",label:"Product Two"},{id:"rad3",value:"harvest/product-instance-three.json",label:"Product Three"}];I(),P(),W(),ba(),ia(),pa(),ESPA.plugins=ESPA.plugins||{},ESPA.plugins.env="dev",Object.defineProperty(a,"__esModule",{value:!0})});
//# sourceMappingURL=main.min.js.map