!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports):"function"==typeof define&&define.amd?define(["exports"],b):b(a.src={})}(this,function(a){"use strict";function b(){return"http://localhost:8888/"}function c(){return"forest"}function d(){return b()+"src/build/plugins/"+c()+"/styles/"+c()+".css"}function f(){var a={grant_type:"arbitrary_identity",client_id:"arbitrary-resource-owner-client",client_secret:"secret",scope:"wizard",arbitrary_claims:"{'preferred_username': ['porky@pig.com'],'name': ['porky@pig.com']}",subject:"PorkyPig",arbitrary_amrs:"['agent:username:agent0@supporttech.com','agent:challenge:fullSSN','agent:challenge:homeZip']",arbitrary_audiences:"['cat','dog']",custom_payload:"{'b':['cat','dog'],'a': {'0': {'Street1': '0 Montana Ave','Street2': null,'Street3': null,'Zip': '90403','City': 'Santa Monica','State': 'California','Country': 'USA'},'1': {'Street1': '1 Montana Ave','Street2': null,'Street3': null,'Zip': '90403','City': 'Santa Monica','State': 'California','Country': 'USA'}}}"},b=[];for(var c in a){var d=encodeURIComponent(c),e=encodeURIComponent(a[c]);b.push(d+"="+e)}return b=b.join("&"),ESPA.plugins.fetchService.fetch("https://p7identityserver4.azurewebsites.net/connect/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},body:b})}function g(a){var b={id_token:a},c=[];for(var d in b){var e=encodeURIComponent(d),f=encodeURIComponent(b[d]);c.push(e+"="+f)}return c=c.join("&"),ESPA.plugins.fetchService.fetch("https://wizardappapi.azurewebsites.net/api/Identity/bind",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"},body:c})}function h(a){return ESPA.plugins.fetchService.fetch("https://wizardappapi.azurewebsites.net/api/Identity/closed",{headers:{Authorization:"Bearer "+a,"x-authScheme":"One"}})}function i(a){return ESPA.plugins.fetchService.fetch("https://wizardappapi.azurewebsites.net/api/RemoteJsonFile/closed?file=entitlements.json",{headers:{Authorization:"Bearer "+a,"x-authScheme":"One"}})}function j(a){return new Promise(function(b,c){b(a)})}function k(a){t=a,s.augmentViewData(r,t);t.wizardState,t.currentPageState,ESPA.plugins.state.get();return Promise.all([ESPA.loadResource.css(d()),f()]).then(function(a){var b=a[1];if(t=Object.assign(t,u),200!=b.response.status){document.getElementById("error").innerHTML="id_token has not been created!"}else{var c=b.json;t.currentPageState.id_token=c.id_token}var d=s.getBackPage(t);ESPA.plugins.wizardEngine.setCurrentState({backPage:d,currentPage:s,nextPage:"page-access-token",back:!!d,next:!0,cancel:!0,finish:!1}),l()}).catch(function(a){return ESPA.logger.error(a),Promise.reject({error:"_registerRouteCallback promise chain terminated"})})}function l(){t.currentPageState;document.getElementById("loader").style.display="none",document.getElementById("wizard-content").innerHTML=ESPA.tmpl(v.factoryScope.tpl,t),document.getElementById("main-container").style.display="block";var a={};ESPA.plugins.bindEvents(a)}function m(a){A=a,z.augmentViewData(y,A);var b=A.wizardState;A.currentPageState.access_token=b.access_token;ESPA.plugins.state.get();return Promise.all([ESPA.loadResource.css(d())]).then(function(a){A=Object.assign(A,B),ESPA.plugins.wizardEngine.setCurrentState({backPage:z.getBackPage(A),currentPage:z,nextPage:"page-entitlements",back:!0,next:!0,cancel:!0,finish:!1}),n()}).catch(function(a){return ESPA.logger.error(a),Promise.reject({error:"_registerRouteCallback promise chain terminated"})})}function n(){document.getElementById("loader").style.display="none",document.getElementById("wizard-content").innerHTML=ESPA.tmpl(C.factoryScope.tpl,A),document.getElementById("main-container").style.display="block",ESPA.plugins.bindEvents({});var a=ESPA.plugins.state.get();if(a.access_token){document.getElementById("access_token").value=a.access_token}}function o(a){H=a,G.augmentViewData(F,H);var b=(H.wizardState,H.currentPageState,ESPA.plugins.state.get());return Promise.all([ESPA.loadResource.css(d())]).then(function(a){H=Object.assign(H,{}),b.identity.forEach(function(a){"http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier"==a.name&&(H.user=a.value),console.log(a)}),H.entitlements=b.entitlements,ESPA.plugins.wizardEngine.setCurrentState({backPage:G.getBackPage(H),currentPage:G,nextPage:null,back:!0,next:!1,cancel:!0,finish:!0}),p()}).catch(function(a){return ESPA.logger.error(a),Promise.reject({error:"_registerRouteCallback promise chain terminated"})})}function p(){H.currentPageState;document.getElementById("loader").style.display="none",document.getElementById("wizard-content").innerHTML=ESPA.tmpl(I.factoryScope.tpl,H),document.getElementById("main-container").style.display="block",ESPA.plugins.bindEvents({})}var q='<div class="container">\r\n    <h1 class="display-3">\r\n        Forest\r\n    </h1>\r\n    <p>\r\n        <input id="id_token" placeholder="enter your id_token..." value="<%= currentPageState.id_token%>">\r\n\r\n\r\n\r\n    </p>\r\n    <p id="error"></p>\r\n\r\n\r\n\r\n</div>',r="page-forest",s=ESPA.plugins.factoryWizardPage({getRouteName:function(){return r},onNext:function(){console.log("onNext");var a=document.getElementById("id_token"),b=ESPA.plugins.state.get().wizardState,c=a.value;return new Promise(function(a,d){g(c).then(function(c){if(200!=c.response.status){document.getElementById("id_token_error").innerHTML="id_token has been rejected!",a(!1)}else{var d=c.json;b.access_token=d.access_token,a(!0)}}).catch(function(a){d(!1),console.log("There has been a problem with your fetch operation: ",a.message)})})},onBack:function(){return console.log("onBack"),j(!0)},onCancel:function(){return console.log("onCancel"),j(!0)}}),t=null,u=null,v={factoryScope:null,tpl:q,wizardPage:s,registerRouteCallback:k},w=s.makeFactory(v),x='<div class="container">\r\n    <h1 class="display-3">access_token</h1>\r\n    <p>\r\n\r\n        <input id="access_token" placeholder="enter your access_token..." value="<%= currentPageState.access_token%>">\r\n    </p>\r\n    <p id="access_token_error"></p>\r\n\r\n</div>',y="page-access-token",z=ESPA.plugins.factoryWizardPage({getRouteName:function(){return y},onNext:function(){console.log("onNext");var a=document.getElementById("access_token"),b=ESPA.plugins.state.get();return b.access_token=a.value,Promise.all([h(b.access_token).then(function(a){return a}).catch(function(a){throw ESPA.logger.error(e),new Error("apiPost error")}),i(b.access_token).then(function(a){return a}).catch(function(a){throw ESPA.logger.error(e),new Error("apiPost error")})]).then(function(a){var c=!1,d=a[0],e=a[1];if(200!=d.response.status){var f=document.getElementById("access_token_error");f.innerHTML="access_token has been rejected!"}else b.identity=d.json,c=!0;if(200!=e.response.status){var f=document.getElementById("access_token_error");f.innerHTML="entitlementResult!"}else b.entitlements=e.json.entitlements;return c}).catch(function(a){return ESPA.logger.error(a),Promise.reject({error:"_registerRouteCallback promise chain terminated"})})},onBack:function(){return console.log("onBack"),j(!0)},onCancel:function(){return console.log("onCancel"),j(!0)}}),A=null,B=null,C={factoryScope:null,tpl:x,wizardPage:z,registerRouteCallback:m},D=z.makeFactory(C),E='<div class="container">\r\n    <h1 class="display-3">\r\n        <%= user %>\r\n    </h1>\r\n \r\n    <ul id="my-list">\r\n        <% for ( var i = 0; i < entitlements.length; i++ ) { \r\n                var entitlement = entitlements[i];%>\r\n        <li>\r\n            <%= entitlement.name %>\r\n        </li>\r\n\r\n        <% } %>\r\n    </ul>\r\n</div>',F="page-entitlements",G=ESPA.plugins.factoryWizardPage({getRouteName:function(){return F},onNext:function(){return console.log("onNext"),j(!0)},onBack:function(){return console.log("onBack"),j(!0)},onCancel:function(){return console.log("onCancel"),j(!0)}}),H=null,I={factoryScope:null,tpl:E,wizardPage:G,registerRouteCallback:o},J=G.makeFactory(I);w(),D(),J(),ESPA.plugins=ESPA.plugins||{},ESPA.plugins.env="prod",Object.defineProperty(a,"__esModule",{value:!0})});
//# sourceMappingURL=main.min.js.map